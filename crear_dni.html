<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Crear Ficha - CNP</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">REGISTRO DE CIUDADANOS</div>
        <button onclick="location.href='menu.html'" class="btn-logout">Volver</button>
    </nav>

    <div class="main-container" style="justify-content: center;">
        <div class="panel" style="width: 500px; padding: 30px;">
            <h2><i class="fas fa-user-plus"></i> NUEVA FICHA POLICIAL</h2>
            
            <div class="input-group">
                <label>Nombre y Apellidos:</label>
                <input type="text" id="nombre" placeholder="Ej: Manolo Lama">
            </div>
            
            <div class="input-group">
                <label>DNI / Pasaporte:</label>
                <input type="text" id="dni" placeholder="Ej: 12345678X">
            </div>

            <div class="input-group">
                <label>Fecha de Nacimiento:</label>
                <input type="date" id="nacimiento">
            </div>

            <div class="input-group">
                <label>URL Foto (Discord/Imgur):</label>
                <input type="text" id="foto" placeholder="https://...">
            </div>

            <div class="input-group">
                <label>Género:</label>
                <select id="genero" style="width:100%; padding:10px; background:#333; color:white; border:none;">
                    <option value="H">Hombre</option>
                    <option value="M">Mujer</option>
                </select>
            </div>

            <button id="btnGuardar" class="btn-login" style="margin-top:20px; background:var(--success)">GUARDAR EN BASE DE DATOS</button>
        </div>
    </div>

    <!-- Script tipo MODULO para usar Firebase -->
    <script type="module">
        import { db, collection, addDoc } from './firebase.js';

        document.getElementById('btnGuardar').addEventListener('click', async () => {
            const nombre = document.getElementById('nombre').value;
            const dni = document.getElementById('dni').value;
            const nacimiento = document.getElementById('nacimiento').value;
            const foto = document.getElementById('foto').value;
            const genero = document.getElementById('genero').value;

            if(!nombre || !dni) return alert("Faltan datos obligatorios");

            try {
                // GUARDAR EN GOOGLE FIRESTORE
                await addDoc(collection(db, "ciudadanos"), {
                    nombre: nombre,
                    dni: dni,
                    nacimiento: nacimiento,
                    foto: foto,
                    genero: genero,
                    fechaRegistro: new Date().toISOString()
                });
                alert("✅ CIUDADANO REGISTRADO CORRECTAMENTE");
                location.href = 'menu.html';
            } catch (e) {
                console.error("Error: ", e);
                alert("❌ Error al guardar en la base de datos.");
            }
        });
    </script>
</body>
</html>
