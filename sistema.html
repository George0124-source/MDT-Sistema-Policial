<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDT - Sistema Central</title>
    <!-- Cargamos el estilo con v=3.0 para forzar actualización -->
    <link rel="stylesheet" href="style.css?v=3.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <nav class="navbar">
        <div class="nav-brand">MDT POLICIAL</div>
        <div class="nav-user">
            <span id="infoOficial" style="margin-right:10px; font-size:14px; color:#ccc;"></span>
            <button onclick="window.logout()" class="btn-logout">Salir</button>
        </div>
    </nav>

    <div class="main-container">
        
        <!-- COLUMNA IZQUIERDA: LEYES -->
        <div class="panel left">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Buscar artículo o ley...">
                <i class="fas fa-search"></i>
            </div>
            <div id="articlesList" class="list-container">
                <!-- Se rellena con JS -->
            </div>
        </div>

        <!-- COLUMNA DERECHA: PROCESAMIENTO -->
        <div class="panel right">
            
            <!-- SECCIÓN 1: BUSCAR ANTECEDENTES (Firebase) -->
            <div class="history-section">
                <h4 style="margin-top:0; color:var(--accent)"><i class="fas fa-history"></i> BUSCAR ANTECEDENTES</h4>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="searchHistoryID" placeholder="ID Discord del Ciudadano" style="margin:0;">
                    <button onclick="window.buscarAntecedentes()" class="btn-blue" style="width:auto;"><i class="fas fa-search"></i></button>
                </div>
                <div id="historyResults" style="margin-top:10px; max-height:150px; overflow-y:auto;"></div>
            </div>

            <!-- SECCIÓN 2: CALCULADORA -->
            <div class="report-header">
                <h4 style="margin:0; color:var(--text-main)"><i class="fas fa-calculator"></i> NUEVO REPORTE</h4>
            </div>
            
            <div id="summaryList" class="summary-list"></div>

            <div class="report-footer">
                <div class="total-row"><span>MULTA:</span> <span id="totalFine" class="amount">0€</span></div>
                <div class="total-row"><span>CÁRCEL:</span> <span id="totalJail" class="jail-time">0m</span></div>
                
                <div class="input-group">
                    <input type="text" id="detenidoInput" placeholder="Nombre del Detenido">
                    <input type="text" id="discordDetenidoInput" placeholder="ID Discord (OBLIGATORIO PARA HISTORIAL)">
                    <textarea id="detallesInput" placeholder="Detalles del suceso..."></textarea>
                </div>

                <div class="action-buttons">
                    <button onclick="window.clearAll()" class="btn btn-red">Limpiar</button>
                    <button onclick="window.copyReport()" class="btn btn-blue">Copiar</button>
                </div>
                <div class="action-buttons">
                    <button onclick="window.enviarInforme('multa')" class="btn btn-yellow">MULTA</button>
                    <button onclick="window.enviarInforme('arresto')" class="btn btn-orange">ARRESTO</button>
                    <button onclick="window.enviarInforme('denuncia')" class="btn btn-purple">DENUNCIA</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 1. Cargamos configuración -->
    <script src="config.js?v=3.0"></script>

    <!-- 2. PUENTE DE CONEXIÓN CON LA BASE DE DATOS -->
    <!-- Este script hace que Firebase funcione dentro de app.js -->
    <script type="module">
        import { db, collection, addDoc, getDocs, query, where, orderBy } from './firebase.js?v=3.0';
        
        // Hacemos las herramientas de base de datos globales para que app.js pueda usarlas
        window.db = db;
        window.collection = collection;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.query = query;
        window.where = where;
        window.orderBy = orderBy;
    </script>

    <!-- 3. Cargamos la lógica y las leyes (EL TRUCO DEL v=3.0) -->
    <!-- El atributo 'defer' asegura que se cargue después del puente de arriba -->
    <script src="app.js?v=3.0" defer></script>

    <script>
        // Seguridad Básica: Si no estás logueado, te echa.
        const checkUser = sessionStorage.getItem('oficialLogueado');
        if (!checkUser) {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
