<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDT - Peninsula RP | V2</title>
    <link rel="icon" type="image/png" href="Peninsula.png">
    <!-- Actualizado a v=8.0 para forzar cambios -->
    <link rel="stylesheet" href="style.css?v=8.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .section-title {
            background-color: var(--cnp-blue);
            color: white;
            padding: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 15px;
            border-left: 4px solid var(--accent);
            font-size: 13px;
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-brand">MDT POLICIAL - PENINSULA RP | V2</div>
        <div class="nav-user">
            <span id="infoOficial" style="margin-right:10px; font-size:14px; color:#ccc;">Agente</span>
            <button onclick="window.logout()" class="btn-logout">Salir</button>
        </div>
    </nav>

    <div class="main-container">
        
        <!-- IZQUIERDA: LEYES -->
        <div class="panel left">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Buscar infracci√≥n (ej: velocidad, fuga, 3.1)...">
                <i class="fas fa-search"></i>
            </div>
            <div id="articlesList" class="list-container"></div>
        </div>

        <!-- DERECHA: PROCESAMIENTO -->
        <div class="panel right">
            
            <!-- BUSCAR ANTECEDENTES -->
            <div class="history-section">
                <h4 style="margin-top:0; color:var(--accent)"><i class="fas fa-history"></i> BUSCAR ANTECEDENTES</h4>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="searchHistoryID" placeholder="ID Discord del Ciudadano" style="margin:0;">
                    <button onclick="window.buscarAntecedentes()" class="btn-blue" style="width:auto;"><i class="fas fa-search"></i></button>
                </div>
                <div id="historyResults" style="margin-top:10px; max-height:150px; overflow-y:auto;"></div>
            </div>

            <!-- CALCULADORA -->
            <div class="report-header">
                <h4 style="margin:0; color:var(--text-main)"><i class="fas fa-calculator"></i> NUEVO REPORTE</h4>
            </div>
            
            <div id="summaryList" class="summary-list">
                <p style="text-align:center; color:#666;">Selecciona art√≠culos de la izquierda.</p>
            </div>

            <div class="report-footer">
                <div class="total-row"><span>MULTA:</span> <span id="totalFine" class="amount">0‚Ç¨</span></div>
                <div class="total-row"><span>C√ÅRCEL:</span> <span id="totalJail" class="jail-time">0m</span></div>
                
                <div class="input-group">
                    <input type="text" id="detenidoInput" placeholder="Nombre del Detenido">
                    <input type="text" id="discordDetenidoInput" placeholder="ID Discord (OBLIGATORIO PARA HISTORIAL)">
                    <textarea id="detallesInput" placeholder="Detalles del suceso..."></textarea>
                </div>

                <div class="action-buttons">
                    <button onclick="window.clearAll()" class="btn btn-red">Limpiar</button>
                    <button onclick="window.copyReport()" class="btn btn-blue">Copiar</button>
                </div>
                <div class="action-buttons">
                    <button onclick="window.enviarInforme('multa')" class="btn btn-yellow">MULTA</button>
                    <button onclick="window.enviarInforme('arresto')" class="btn btn-orange">ARRESTO</button>
                    <button onclick="window.enviarInforme('denuncia')" class="btn btn-purple">DENUNCIA</button>
                </div>
            </div>
        </div>
    </div>

    <!-- CONFIG Y FIREBASE -->
    <script src="config.js?v=8.0"></script>
    <script type="module">
        import { db, collection, addDoc, getDocs, query, where, orderBy } from './firebase.js';

        // --- C√ìDIGO PENAL PENINSULA RP | V2 ---
        const codigoPenal = [
            
            // CAP I: TR√ÅFICO (B√ÅSICO)
            { header: true, titulo: "üöó CAP I: SEGURIDAD VIAL (B√ÅSICO)" },
            { id: "1.1", titulo: "Uso excesivo del claxon", multa: 100, meses: 0 },
            { id: "1.2", titulo: "Giro indebido", multa: 125, meses: 0 },
            { id: "1.3", titulo: "Circular sentido contrario", multa: 1950, meses: 0 },
            { id: "1.4", titulo: "Estacionar zona prohibida", multa: 225, meses: 0 },
            { id: "1.5", titulo: "Ignorar se√±ales tr√°fico", multa: 275, meses: 0 },
            { id: "1.6", titulo: "Saltarse sem√°foro", multa: 550, meses: 0 },
            { id: "1.7", titulo: "No ceder emergencias", multa: 990, meses: 0 },
            { id: "1.8", titulo: "Adelantamiento indebido", multa: 150, meses: 0 },
            { id: "1.9", titulo: "Ignorar polic√≠a tr√°fico", multa: 500, meses: 1 },
            { id: "1.10", titulo: "Saltarse control tr√°fico", multa: 1000, meses: 3 },
            { id: "1.11", titulo: "Veh√≠culo malas condiciones", multa: 1150, meses: 0 },
            { id: "1.12", titulo: "Exceso velocidad", multa: 300, meses: 0 },
            { id: "1.13", titulo: "Conducci√≥n temeraria", multa: 300, meses: 0 },
            { id: "1.14", titulo: "Conducir bajo efectos", multa: 750, meses: 0 },
            { id: "1.15", titulo: "Iniciar persecuci√≥n", multa: 2500, meses: 7 },
            { id: "1.16", titulo: "Provocar accidente", multa: 3500, meses: 5 },
            { id: "1.17", titulo: "Sin luces de noche", multa: 250, meses: 0 },
            { id: "1.18", titulo: "No usar intermitentes", multa: 275, meses: 0 },
            { id: "1.19", titulo: "Negarse inspecci√≥n", multa: 225, meses: 0 },
            { id: "1.20", titulo: "Veh√≠culo granja en urbana", multa: 750, meses: 0 },
            { id: "1.21", titulo: "Baja velocidad autopista", multa: 300, meses: 0 },
            { id: "1.22", titulo: "Participar carrera ilegal", multa: 2000, meses: 24 },
            { id: "1.23", titulo: "Accidente carrera ilegal", multa: 2700, meses: 48 },
            { id: "1.24", titulo: "Muerte en carrera (CK)", multa: 12999, meses: 999 },
            { id: "1.25", titulo: "Atropello y fuga", multa: 3500, meses: 72 },
            { id: "1.26", titulo: "Atropello da√±os psicol√≥gicos", multa: 50000, meses: 0 },
            { id: "1.27", titulo: "Sin carnet Tipo A", multa: 2000, meses: 0 },
            { id: "1.28", titulo: "Sin carnet Tipo B", multa: 1000, meses: 0 },
            { id: "1.29", titulo: "Carnet caducado", multa: 200, meses: 0 },
            { id: "1.30", titulo: "Sin ITV", multa: 500, meses: 0 },

            // T√çTULO III: TR√ÅFICO (DETALLADO) - A√ëADIDO POR PETICI√ìN
            { header: true, titulo: "üöó T√çTULO III: TR√ÅFICO (DETALLADO)" },
            { id: "3.1.1", titulo: "Exceso velocidad (+40km/h)", multa: 100, meses: 0 },
            { id: "3.1.2", titulo: "Exceso velocidad (+60km/h)", multa: 200, meses: 0 },
            { id: "3.1.3", titulo: "Exceso velocidad (+80km/h)", multa: 400, meses: 0 },
            { id: "3.1.4", titulo: "Exceso velocidad (+100km/h)", multa: 500, meses: 1 },
            { id: "3.1.5", titulo: "Exceso velocidad (+120km/h)", multa: 600, meses: 1 },
            { id: "3.1.6", titulo: "Conducci√≥n temeraria", multa: 500, meses: 0 },
            { id: "3.1.7", titulo: "Conductor en mal estado", multa: 1000, meses: 0 },
            { id: "3.1.8", titulo: "Accidente sin heridos", multa: 3000, meses: 0 },
            { id: "3.1.9", titulo: "Accidente con heridos", multa: 5000, meses: 0 },
            { id: "3.1.10", titulo: "Provocar accidente grave", multa: 10000, meses: 0.25 },
            { id: "3.1.11", titulo: "Sin cintur√≥n abrochado", multa: 200, meses: 0 },
            { id: "3.1.12", titulo: "Estacionar lugar no permitido", multa: 200, meses: 0 },
            { id: "3.1.13", titulo: "Estacionar indebidamente", multa: 100, meses: 0 },
            { id: "3.1.14", titulo: "Ignorar se√±ales tr√°fico", multa: 500, meses: 0 },
            { id: "3.1.15", titulo: "Saltarse sem√°foro rojo", multa: 200, meses: 0 },
            { id: "3.1.16", titulo: "Uso excesivo claxon", multa: 150, meses: 0 },
            { id: "3.1.17", titulo: "Giro indebido", multa: 150, meses: 0 },
            { id: "3.1.18", titulo: "Circular sentido contrario", multa: 200, meses: 0 },
            { id: "3.1.19", titulo: "No ceder paso emergencias", multa: 1000, meses: 0 },
            { id: "3.1.20", titulo: "Adelantamiento indebido", multa: 300, meses: 0 },
            { id: "3.1.21", titulo: "Circular marcha atr√°s", multa: 500, meses: 0 },
            { id: "3.1.22", titulo: "Saltarse control de tr√°fico", multa: 3000, meses: 5 },
            { id: "3.1.23", titulo: "Veh√≠culo malas condiciones", multa: 200, meses: 0 },
            { id: "3.1.24", titulo: "Conducir bajo drogas/alcohol", multa: 1000, meses: 1 },
            { id: "3.1.25", titulo: "Negarse prueba alcohol/drogas", multa: 2000, meses: 2 },
            { id: "3.1.26", titulo: "No colocar faros de noche", multa: 100, meses: 0 },
            { id: "3.1.27", titulo: "Sin intermitentes al girar", multa: 50, meses: 0 },
            { id: "3.1.28", titulo: "Sin intermitentes al aparcar", multa: 100, meses: 0 },
            { id: "3.1.29", titulo: "Veh√≠culo pesado en puente", multa: 1000, meses: 0 },
            { id: "3.1.30", titulo: "Negarse inspecci√≥n veh√≠culo", multa: 1000, meses: 0 },
            { id: "3.1.31", titulo: "Modificaciones ilegales", multa: 500, meses: 0 },
            { id: "3.1.32", titulo: "Tractor por v√≠a p√∫blica", multa: 500, meses: 0 },
            { id: "3.1.33", titulo: "Iniciar persecuci√≥n", multa: 1000, meses: 12 },

            // CAP II: CONDUCTAS
            { header: true, titulo: "üë§ CONDUCTAS CIUDADAN√çA" },
            { id: "2.1", titulo: "Alteraci√≥n orden p√∫blico", multa: 500, meses: 0 },
            { id: "2.2", titulo: "Racismo / Xenofobia", multa: 800, meses: 0 },
            { id: "2.3", titulo: "Faltas respeto", multa: 500, meses: 0 },
            { id: "2.4", titulo: "Da√±ar mobiliario", multa: 500, meses: 0 },
            { id: "2.5", titulo: "Intento violaci√≥n", multa: 4450, meses: 96 },
            { id: "2.6", titulo: "Violaci√≥n", multa: 22500, meses: 264 },
            { id: "2.7", titulo: "Amenaza muerte civil", multa: 4000, meses: 12 },
            { id: "2.8", titulo: "Acoso sexual", multa: 5500, meses: 0 },
            { id: "2.9", titulo: "M√°scara sin motivo", multa: 1500, meses: 0 },
            { id: "2.10", titulo: "Desnudo en v√≠a p√∫blica", multa: 700, meses: 0 },
            { id: "2.11", titulo: "Peleas v√≠a p√∫blica", multa: 1000, meses: 1 },
            { id: "2.12", titulo: "Insultos graves", multa: 1500, meses: 0 },
            { id: "2.13", titulo: "Disturbios eventos", multa: 2000, meses: 2 },
            { id: "2.14", titulo: "Uso indebido pirotecnia", multa: 500, meses: 0 },
            { id: "2.15", titulo: "Tirar basura", multa: 200, meses: 0 },
            { id: "2.16", titulo: "Ruidos molestos", multa: 300, meses: 0 },
            { id: "2.17", titulo: "Incumplir normativa eventos", multa: 1000, meses: 0 },
            { id: "2.18", titulo: "Obstrucci√≥n autoridad", multa: 2500, meses: 1 },
            { id: "2.19", titulo: "Falsas denuncias", multa: 2000, meses: 1 },
            { id: "2.20", titulo: "Suplantaci√≥n identidad", multa: 3000, meses: 2 },
            { id: "2.21", titulo: "Actos obscenos", multa: 1200, meses: 0 },
            { id: "2.22", titulo: "Esc√°ndalo p√∫blico", multa: 800, meses: 0 },
            { id: "2.23", titulo: "Lenguaje ofensivo", multa: 400, meses: 0 },
            { id: "2.24", titulo: "Negarse a identificarse", multa: 1500, meses: 0 },
            { id: "2.25", titulo: "Obstaculizar tr√°fico", multa: 1000, meses: 0 },
            { id: "2.26", titulo: "Intento soborno func.", multa: 5000, meses: 3 },
            { id: "2.27", titulo: "Reuniones clandestinas", multa: 4000, meses: 2 },
            { id: "2.28", titulo: "Disfraz para delinquir", multa: 2500, meses: 0 },
            { id: "2.29", titulo: "Grabar sin permiso", multa: 750, meses: 0 },
            { id: "2.30", titulo: "Negarse a pagar servicio", multa: 1000, meses: 0 },

            // CAP III: ESTUPEFACIENTES
            { header: true, titulo: "üåø ESTUPEFACIENTES" },
            { id: "3.1", titulo: "Posesi√≥n drogas (peque√±a)", multa: 1000, meses: 0 },
            { id: "3.2", titulo: "Posesi√≥n drogas (grande)", multa: 2000, meses: 24 },
            { id: "3.3", titulo: "Tr√°fico drogas", multa: 3000, meses: 24 },
            { id: "3.4", titulo: "Consumo drogas p√∫blico", multa: 800, meses: 0 },
            { id: "3.5", titulo: "Venta drogas a menores", multa: 5000, meses: 4 },
            { id: "3.6", titulo: "Fabricaci√≥n sustancias", multa: 6000, meses: 6 },
            { id: "3.7", titulo: "Conducir bajo efectos", multa: 3000, meses: 0 },
            { id: "3.8", titulo: "Transportar drogas veh√≠culo", multa: 2500, meses: 1 },
            { id: "3.9", titulo: "Pertenencia cartel", multa: 7000, meses: 6 },
            { id: "3.10", titulo: "Utensilios drogas", multa: 1500, meses: 0 },
            { id: "3.11", titulo: "Venta medicamentos ilegal", multa: 3500, meses: 1 },
            { id: "3.12", titulo: "Cultivo ilegal", multa: 4500, meses: 2 },
            { id: "3.13", titulo: "Distribuci√≥n eventos", multa: 5000, meses: 3 },
            { id: "3.14", titulo: "Laboratorio clandestino", multa: 10000, meses: 12 },
            { id: "3.15", titulo: "Meter drogas prisi√≥n", multa: 6000, meses: 4 },
            { id: "3.16", titulo: "Financiamiento drogas", multa: 7500, meses: 5 },
            { id: "3.17", titulo: "Menores transporte drogas", multa: 8000, meses: 6 },
            { id: "3.18", titulo: "Publicidad drogas", multa: 2000, meses: 0 },

            // CAP IV: ARMAS
            { header: true, titulo: "üî´ ARMAS DE FUEGO" },
            { id: "4.1", titulo: "Posesi√≥n sin licencia", multa: 2500, meses: 1 },
            { id: "4.2", titulo: "Venta ilegal armas", multa: 5000, meses: 3 },
            { id: "4.3", titulo: "Uso armas v√≠a p√∫blica", multa: 3500, meses: 2 },
            { id: "4.4", titulo: "Modificaci√≥n ilegal", multa: 4000, meses: 3 },
            { id: "4.5", titulo: "Contrabando armas", multa: 7000, meses: 6 },
            { id: "4.6", titulo: "Amenazar con arma", multa: 3000, meses: 2 },
            { id: "4.7", titulo: "Portar arma guerra", multa: 10000, meses: 6 },
            { id: "4.8", titulo: "Disparos injustificados", multa: 5000, meses: 3 },
            { id: "4.9", titulo: "Portar Beretta M9 (Mal uso)", multa: 2500, meses: 0 },
            { id: "4.10", titulo: "Portar Colt M1911 (Ilegal)", multa: 2500, meses: 0 },
            { id: "4.11", titulo: "Portar TEC-9", multa: 4000, meses: 0 },
            { id: "4.12", titulo: "Portar AK-47", multa: 18000, meses: 24 },
            { id: "4.13", titulo: "Portar LMT-L129A1", multa: 10000, meses: 24 },
            { id: "4.14", titulo: "Objeto punzante >13cm", multa: 1000, meses: 0 },
            { id: "4.15", titulo: "Venta munici√≥n ilegal", multa: 2000, meses: 0 },
            { id: "4.16", titulo: "Fabricaci√≥n casera", multa: 6500, meses: 4 },
            { id: "4.17", titulo: "Amenazar funcionario arma", multa: 4500, meses: 3 },
            { id: "4.18", titulo: "Armas eventos/zonas seguras", multa: 8000, meses: 5 },
            { id: "4.19", titulo: "Armas edificios gob.", multa: 7000, meses: 4 },
            { id: "4.20", titulo: "Armas en robos", multa: 10000, meses: 12 },

            // CAP V: HOMICIDIOS Y AGRESIONES
            { header: true, titulo: "üî™ HOMICIDIOS Y AGRESIONES" },
            { id: "5.1", titulo: "Agresi√≥n a civil", multa: 2000, meses: 12 },
            { id: "5.2", titulo: "Robo a civil", multa: 3500, meses: 15 },
            { id: "5.3", titulo: "Robo veh√≠culo", multa: 1500, meses: 6 },
            { id: "5.4", titulo: "Allanamiento", multa: 3250, meses: 12 },
            { id: "5.5", titulo: "Detenci√≥n ilegal", multa: 4000, meses: 0 },
            { id: "5.6", titulo: "Secuestro", multa: 5000, meses: 24 },
            { id: "5.7", titulo: "Tentativa secuestro", multa: 2500, meses: 12 },
            { id: "5.8", titulo: "Homicidio tentativa", multa: 7000, meses: 24 },
            { id: "5.9", titulo: "Homicidio", multa: 18000, meses: 30 },
            { id: "5.10", titulo: "Homicidio imprudente", multa: 12500, meses: 24 },
            { id: "5.11", titulo: "Asesinato", multa: 20000, meses: 124 },
            { id: "5.12", titulo: "Trata de personas", multa: 17500, meses: 30 },
            { id: "5.13", titulo: "Amenaza civil", multa: 2000, meses: 0 },
            { id: "5.14", titulo: "Amenaza civil (Arma blanca)", multa: 2000, meses: 2 },
            { id: "5.15", titulo: "Violaci√≥n orden judicial", multa: 1000, meses: 24 },
            { id: "5.16", titulo: "Estafa o fraude", multa: 2500, meses: 12 },
            { id: "5.17", titulo: "Destrucci√≥n pruebas", multa: 1500, meses: 6 },
            { id: "5.18", titulo: "Soborno funcionario", multa: 3000, meses: 4 },
            { id: "5.19", titulo: "Ultraje s√≠mbolo nacional", multa: 800, meses: 0 },
            { id: "5.20", titulo: "Sabotaje infra. p√∫blica", multa: 5000, meses: 18 },

            // CAP VI: ADMINISTRACI√ìN P√öBLICA
            { header: true, titulo: "üëÆ CONTRA ADMINISTRACI√ìN P√öBLICA" },
            { id: "6.1", titulo: "Violaci√≥n orden judicial", multa: 1000, meses: 30 },
            { id: "6.2", titulo: "Obstrucci√≥n justicia", multa: 2500, meses: 9 },
            { id: "6.3", titulo: "Resistencia autoridad", multa: 2500, meses: 6 },
            { id: "6.4", titulo: "Negaci√≥n identificarse", multa: 1000, meses: 9 },
            { id: "6.5", titulo: "Negaci√≥n licencias", multa: 750, meses: 6 },
            { id: "6.6", titulo: "Material confidencial", multa: 1500, meses: 12 },
            { id: "6.7", titulo: "Soborno funcionario", multa: 5000, meses: 24 },
            { id: "6.8", titulo: "Desacato autoridad", multa: 2500, meses: 12 },
            { id: "6.9", titulo: "Malversaci√≥n fondos", multa: 25000, meses: 24 },
            { id: "6.10", titulo: "Detenci√≥n ilegal (Func)", multa: 4000, meses: 0 },
            { id: "6.11", titulo: "Amenaza funcionario", multa: 3000, meses: 12 },
            { id: "6.12", titulo: "Agresi√≥n funcionario", multa: 5000, meses: 18 },
            { id: "6.13", titulo: "Secuestro funcionario", multa: 10000, meses: 36 },
            { id: "6.14", titulo: "Tentativa homicidio func.", multa: 15000, meses: 40 },
            { id: "6.15", titulo: "Homicidio funcionario", multa: 25000, meses: 420 }, // 35 a√±os
            { id: "6.16", titulo: "Asesinato funcionario (CK)", multa: 35000, meses: 999 },
            { id: "6.17", titulo: "Falsificaci√≥n doc. oficial", multa: 2000, meses: 12 },
            { id: "6.18", titulo: "Uso indebido bienes", multa: 1500, meses: 6 },

            // CAP VII: ROBOS
            { header: true, titulo: "üè¶ ROBOS MENORES Y MAYORES" },
            { id: "7.1", titulo: "Hurto", multa: 1500, meses: 6 },
            { id: "7.2", titulo: "Robo civil con violencia", multa: 3500, meses: 15 },
            { id: "7.3", titulo: "Robo veh√≠culo", multa: 2500, meses: 12 },
            { id: "7.4", titulo: "Robo veh√≠culo lujo", multa: 5000, meses: 18 },
            { id: "7.5", titulo: "Robo comercio", multa: 4000, meses: 15 },
            { id: "7.6", titulo: "Robo banco/inst. p√∫blica", multa: 7500, meses: 24 },
            { id: "7.7", titulo: "Robo arma fuego", multa: 8000, meses: 30 },
            { id: "7.8", titulo: "Robo con rehenes", multa: 15000, meses: 36 },
            { id: "7.9", titulo: "Robo vivienda", multa: 5000, meses: 18 },
            { id: "7.10", titulo: "Uso inhibidores", multa: 6000, meses: 24 },
            { id: "7.11", titulo: "Herramientas robo", multa: 3000, meses: 12 },
            { id: "7.12", titulo: "Robo Mayor (Banco/Joyer√≠a)", multa: 15000, meses: 20 },
            { id: "7.13", titulo: "Arrebato", multa: 1000, meses: 4 },
            { id: "7.14", titulo: "Robo con explosivos", multa: 10000, meses: 30 },
            { id: "7.15", titulo: "Robo patrimonio", multa: 12000, meses: 36 },
            { id: "7.16", titulo: "Robo/Secuestro Realeza", multa: 50000, meses: 480 },

            // CAP VIII: BANDAS
            { header: true, titulo: "‚ôüÔ∏è BANDAS CRIMINALES" },
            { id: "8.1", titulo: "Pertenencia banda", multa: 7500, meses: 48 },
            { id: "8.2", titulo: "Jefe de banda", multa: 0, meses: 999 },
            { id: "8.3", titulo: "Financiamiento banda", multa: 12500, meses: 60 },
            { id: "8.4", titulo: "Colaboraci√≥n banda", multa: 5000, meses: 36 },
            { id: "8.5", titulo: "Asociaci√≥n delinquir", multa: 6000, meses: 24 },
            { id: "8.6", titulo: "Violencia territorial", multa: 9000, meses: 60 },
            { id: "8.7", titulo: "Extorsi√≥n organizada", multa: 10000, meses: 60 },
            { id: "8.8", titulo: "Atentado entidad", multa: 15000, meses: 96 },
            { id: "8.9", titulo: "Secuestro organizado", multa: 20000, meses: 120 },
            { id: "8.10", titulo: "Tr√°fico armas organizado", multa: 18000, meses: 72 },
            { id: "8.11", titulo: "Tr√°fico drogas organizado", multa: 20000, meses: 144 },
            { id: "8.12", titulo: "Lavado dinero", multa: 25000, meses: 72 },
            { id: "8.13", titulo: "Conspiraci√≥n transnacional", multa: 22000, meses: 72 },
            { id: "8.14", titulo: "Tr√°fico humanos org.", multa: 30000, meses: 180 },
            { id: "8.15", titulo: "Corrupci√≥n funcionario", multa: 14000, meses: 36 },
            { id: "8.16", titulo: "Fraude inform√°tico org.", multa: 12000, meses: 24 },

            // CAP IX: FALSIFICACI√ìN
            { header: true, titulo: "üìÑ FALSIFICACI√ìN" },
            { id: "9.1", titulo: "Falsificaci√≥n doc. p√∫blico", multa: 7500, meses: 24 },
            { id: "9.2", titulo: "Falsificaci√≥n doc. privado", multa: 5000, meses: 18 },
            { id: "9.3", titulo: "Uso documento falso", multa: 4000, meses: 12 },
            { id: "9.4", titulo: "Alteraci√≥n doc. oficial", multa: 6000, meses: 24 },
            { id: "9.5", titulo: "Falsificaci√≥n firmas", multa: 5500, meses: 18 },
            { id: "9.6", titulo: "Uso identidad falsa", multa: 7000, meses: 100 },
            { id: "9.7", titulo: "Suplantaci√≥n ciudadano", multa: 8000, meses: 36 },
            { id: "9.8", titulo: "Suplantaci√≥n funcionario", multa: 10000, meses: 42 },
            { id: "9.9", titulo: "Falsificaci√≥n licencias", multa: 8500, meses: 36 },
            { id: "9.10", titulo: "Distribuci√≥n docs falsos", multa: 12000, meses: 48 },

            // CAP X: IDENTIDAD
            { header: true, titulo: "üí≥ SUPLANTACI√ìN IDENTIDAD" },
            { id: "10.1", titulo: "Suplantaci√≥n ciudadano", multa: 7000, meses: 24 },
            { id: "10.2", titulo: "Suplantaci√≥n funcionario", multa: 10000, meses: 36 },
            { id: "10.3", titulo: "Suplantaci√≥n polic√≠a/militar", multa: 12000, meses: 42 },
            { id: "10.4", titulo: "Suplantaci√≥n fraude", multa: 15000, meses: 48 },
            { id: "10.5", titulo: "Identidad robada sistemas", multa: 13000, meses: 42 },
            { id: "10.6", titulo: "Venta identidades", multa: 14000, meses: 48 },
            { id: "10.7", titulo: "Suplantaci√≥n redes sociales", multa: 6000, meses: 18 },
            { id: "10.8", titulo: "Identidades falsas m√∫ltiples", multa: 16000, meses: 54 },
            { id: "10.9", titulo: "Suplantaci√≥n figura p√∫blica", multa: 11000, meses: 36 },

            // CAP XI: NATURALEZA
            { header: true, titulo: "‚òòÔ∏è ATENTADOS NATURALEZA" },
            { id: "11.1", titulo: "Vertido t√≥xico", multa: 20000, meses: 60 },
            { id: "11.2", titulo: "Tala ilegal", multa: 12000, meses: 36 },
            { id: "11.3", titulo: "Caza/Pesca ilegal", multa: 15000, meses: 48 },
            { id: "11.4", titulo: "Incendio forestal", multa: 25000, meses: 72 },
            { id: "11.5", titulo: "Contaminaci√≥n agua", multa: 18000, meses: 54 },
            { id: "11.6", titulo: "Construcci√≥n ilegal", multa: 17000, meses: 42 },
            { id: "11.7", titulo: "Tr√°fico flora/fauna", multa: 16000, meses: 48 },
            { id: "11.8", titulo: "Qu√≠micos prohibidos", multa: 14000, meses: 36 },
            { id: "11.9", titulo: "Destrucci√≥n h√°bitats", multa: 19000, meses: 60 },
            { id: "11.10", titulo: "Entrada ilegal High Rock", multa: 13000, meses: 36 },
            { id: "11.11", titulo: "Encubrimiento ecol√≥gico", multa: 22000, meses: 60 },
            { id: "11.12", titulo: "Reincidencia ambiental", multa: 0, meses: 12 }
        ];

        // --- 2. L√ìGICA DE LA P√ÅGINA ---
        let selected = [];

        // Inicializaci√≥n
        const user = JSON.parse(sessionStorage.getItem('oficialLogueado'));
        if (!user) window.location.href = 'index.html';
        document.getElementById('infoOficial').textContent = `${user.rango} ${user.placa}`;

        renderList(codigoPenal);

        // Evento Buscador
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            const filt = codigoPenal.filter(x => {
                if(x.header) return false;
                return x.titulo.toLowerCase().includes(val) || x.id.includes(val);
            });
            renderList(filt);
        });

        // Funciones del Sistema
        function renderList(arr) {
            const div = document.getElementById('articlesList');
            div.innerHTML = "";
            arr.forEach(art => {
                if(art.header) {
                    const h = document.createElement('div');
                    h.className = 'section-title';
                    h.innerText = art.titulo;
                    div.appendChild(h);
                } else {
                    let t = art.meses > 0 ? (art.meses >= 12 ? (art.meses/12).toFixed(1)+" a√±os" : art.meses+" meses") : "";
                    if(art.meses>=900) t="CADENA PERPETUA";
                    
                    const el = document.createElement('div');
                    el.className = 'article-item';
                    el.innerHTML = `<div><strong style="color:var(--accent)">[${art.id}]</strong> ${art.titulo} <small style="color:#777">${t}</small></div><div class="price-tag">${art.multa.toLocaleString()}‚Ç¨</div>`;
                    el.onclick = () => { selected.push(art); update(); };
                    div.appendChild(el);
                }
            });
        }

        function update() {
            const div = document.getElementById('summaryList');
            div.innerHTML = "";
            let f = 0, j = 0;
            
            if(selected.length===0) div.innerHTML = "<p style='text-align:center;color:#666'>Lista vac√≠a</p>";
            
            selected.forEach((s, i) => {
                f += s.multa; j += s.meses;
                const el = document.createElement('div');
                el.className = 'summary-item';
                el.innerHTML = `<span>${s.titulo}</span><span onclick="window.del(${i})" style="color:var(--danger);cursor:pointer">‚úï</span>`;
                div.appendChild(el);
            });

            document.getElementById('totalFine').innerText = f.toLocaleString() + "‚Ç¨";
            let tText = j + " Meses";
            if(j >= 12) tText = (j/12).toFixed(1) + " A√±os";
            if(j >= 900) tText = "PERPETUA";
            document.getElementById('totalJail').innerText = tText;
        }

        // FUNCIONES GLOBALES
        window.del = (i) => { selected.splice(i, 1); update(); };
        
        window.clearAll = () => { 
            selected = []; 
            document.getElementById('detenidoInput').value = "";
            document.getElementById('discordDetenidoInput').value = "";
            document.getElementById('detallesInput').value = "";
            update(); 
        };

        window.logout = () => { sessionStorage.removeItem('oficialLogueado'); window.location.href = 'index.html'; };

        window.copyReport = () => {
            if(selected.length===0) return alert("Nada que copiar.");
            let txt = "**INFORME POLICIAL**\n";
            selected.forEach(s => txt += `‚Ä¢ ${s.titulo} (${s.multa}‚Ç¨)\n`);
            txt += `TOTAL: ${document.getElementById('totalFine').innerText} | ${document.getElementById('totalJail').innerText}`;
            navigator.clipboard.writeText(txt);
            alert("Copiado");
        };

        // --- BUSCAR ANTECEDENTES ---
        window.buscarAntecedentes = async () => {
            const id = document.getElementById('searchHistoryID').value;
            if(!id) return alert("Pon un ID de Discord.");
            const resDiv = document.getElementById('historyResults');
            resDiv.innerHTML = "Buscando...";
            
            try {
                const q = query(collection(db, "historial_criminal"), where("detenido_id", "==", id), orderBy("fecha", "desc"));
                const snap = await getDocs(q);
                resDiv.innerHTML = "";
                if(snap.empty) { resDiv.innerHTML = "<p style='color:#ccc'>Limpio.</p>"; return; }
                snap.forEach(doc => {
                    const d = doc.data();
                    const f = new Date(d.fecha).toLocaleDateString();
                    resDiv.innerHTML += `<div style="background:#222;padding:5px;margin:5px;border-left:2px solid orange;font-size:12px;"><strong>${d.tipo.toUpperCase()}</strong> - ${f}<br>${d.cargos_resumen}</div>`;
                });
            } catch(e) { console.error(e); resDiv.innerHTML = "Error al buscar."; }
        };

        // --- ENVIAR INFORME ---
        window.enviarInforme = async (tipo) => {
            const nom = document.getElementById('detenidoInput').value;
            const id = document.getElementById('discordDetenidoInput').value;
            const det = document.getElementById('detallesInput').value;

            if(!nom) return alert("Falta nombre.");
            if(selected.length===0) return alert("Falta cargos.");

            let url = ""; let color = 0;
            if(tipo==='multa') { url=WEBHOOK_MULTAS; color=15844367; }
            if(tipo==='arresto') { url=WEBHOOK_ARRESTOS; color=15105570; }
            if(tipo==='denuncia') { url=WEBHOOK_DENUNCIAS; color=10181046; }

            if(url.includes("PEGA_")) return alert("Configura Webhooks en config.js");

            const oficial = JSON.parse(sessionStorage.getItem('oficialLogueado'));
            let ofiTxt = `${oficial.rango} ${oficial.placa}`;
            if(oficial.discordId) ofiTxt += ` <@${oficial.discordId}>`;
            let detTxt = `**${nom}**`;
            if(id) detTxt += ` <@${id}>`;

            const embed = {
                title: "NUEVO REPORTE: "+tipo.toUpperCase(),
                color: color,
                fields: [
                    { name: "Oficial", value: ofiTxt, inline: true },
                    { name: "Ciudadano", value: detTxt, inline: true },
                    { name: "Cargos", value: selected.map(s=>`‚Ä¢ ${s.titulo}`).join("\n") },
                    { name: "Total", value: document.getElementById('totalFine').innerText+" | "+document.getElementById('totalJail').innerText }
                ],
                timestamp: new Date()
            };
            if(det) embed.fields.push({name:"Detalles", value:det});

            fetch(url, {method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({embeds:[embed]})});

            if(id) {
                try {
                    await addDoc(collection(db, "historial_criminal"), {
                        detenido_nombre: nom, detenido_id: id, oficial: `${oficial.rango} ${oficial.placa}`,
                        tipo: tipo, cargos_resumen: selected.map(s=>s.titulo).join(", "),
                        multa_total: document.getElementById('totalFine').innerText,
                        pena_total: document.getElementById('totalJail').innerText,
                        detalles: det, fecha: new Date().toISOString()
                    });
                    alert("‚úÖ Registrado y Guardado.");
                } catch(e) { console.error(e); alert("Registrado en Discord, pero error en Firebase."); }
            } else {
                alert("‚úÖ Registrado en Discord (Sin historial por falta de ID).");
            }
            window.clearAll();
        };
    </script>
</body>
</html>


